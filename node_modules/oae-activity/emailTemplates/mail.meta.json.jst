<%
/*!
 * Get an appropriate message to put in the email subject header:
 *  - When an immediate email is sent with a single activity: `<activitySummary>`
 *  - When an immediate email is sent with multiple actors: `New activity is waiting for you`
 *  - When a daily email is sent: `Today's activity summary`
 *  - When a weekly email is sent: `Last week's activity summary`
 *
 * @param  {Object}         util                The template utility that can be used to encode HTML, translate keys, etc
 * @param  {String}         emailPreference     The email preference for which to generate an email summary
 * @param  {Activity[]}     activitities        The activities for which to generate a summary
 * @return {String}                             An appropriate summary given the user's email preference and given activities
 */
var getSubject = function(util, emailPreference, activities) {
    var message = util.i18n.translate('__MSG__RECENT_ACTIVITY__');
    if (emailPreference === 'immediate') {
        if (activities.length === 1) {
            message = util.i18n.translate(activities[0].summary.i18nKey, activities[0].summary.i18nArguments);
        } else {
            message = util.i18n.translate('__MSG__ACTIVITY_EMAIL_SUBJECT_MULTIPLE__');
        }
    } else if (emailPreference === 'daily') {
        message = util.i18n.translate('__MSG__ACTIVITY_EMAIL_SUBJECT_DAILY__');
    } else if (emailPreference === 'weekly') {
        message = util.i18n.translate('__MSG__ACTIVITY_EMAIL_SUBJECT_WEEKLY__');
    }

    // Convert the message to text in case there was HTML in the translations
    message = util.html.toText(message)

    // Truncate it so we don't max out the subject line
    message = util.text.truncate(message, 150);

    // Ensure it's safe to embed in a JSON value
    message = util.json.escape(message);

    return message;
};
%>
{
    "subject": "<%= getSubject(util, user.emailPreference, activities) %>"
}
